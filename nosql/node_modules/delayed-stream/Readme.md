---
ms.openlocfilehash: 21db9b7ec97b7028a031a18867aab00575b09850
ms.sourcegitcommit: e739004291428ce83f14b9d49f1e9dfaa3762dde
ms.translationtype: HT
ms.contentlocale: pt-BR
ms.lasthandoff: 02/05/2022
ms.locfileid: "138052946"
---
# <a name="delayed-stream"></a>delayed-stream

Armazena os eventos de um fluxo em buffer até que você esteja pronto para processá-los.

## <a name="installation"></a>Instalação

``` bash
npm install delayed-stream
```

## <a name="usage"></a>Uso

O exemplo a seguir mostra como escrever um servidor de eco http que atrasa a resposta em 1000 ms.

``` javascript
var DelayedStream = require('delayed-stream');
var http = require('http');

http.createServer(function(req, res) {
  var delayed = DelayedStream.create(req);

  setTimeout(function() {
    res.writeHead(200);
    delayed.pipe(res);
  }, 1000);
});
```

Se você não estiver usando `Stream#pipe`, também poderá liberar os eventos em buffer manualmente chamando `delayedStream.resume()`:

``` javascript
var delayed = DelayedStream.create(req);

setTimeout(function() {
  // Emit all buffered events and resume underlaying source
  delayed.resume();
}, 1000);
```

## <a name="implementation"></a>Implementação

Para usar esse metafluxo corretamente, veja aqui algumas coisas que você deve saber sobre a implementação.

### <a name="event-buffering--proxying"></a>Buffer e proxy de eventos

Todos os eventos do fluxo `source` são sequestrados substituindo o método `source.emit`. Até que o nó implemente um ouvinte de eventos catch-all, essa é a única maneira.

No entanto, o delayed-stream ainda continua a emitir todos os eventos que captura no `source`, independentemente do fluxo atrasado já ter sido liberado ou não.

Após a criação, o delayed-stream captura todos os eventos de `source` e armazena-os em um buffer de eventos interno. Quando `delayedStream.release()` é chamado, todos os eventos em buffer são emitidos em `delayedStream` e o buffer de eventos é limpo. Depois disso, o delayed-stream atua apenas como um proxy para a origem subjacente.

### <a name="error-handling"></a>Tratamento de erros

O buffer ou o proxy é aplicado nos eventos de erro em `source`, assim como qualquer outro evento.
No entanto, `delayedStream.create` anexa um ouvinte sem operações `'error'` ao `source`. Dessa forma, você só precisa solucionar os erros no objeto `delayedStream`, não em dois lugares.

### <a name="buffer-limits"></a>Limites de buffer

O delayed-stream oferece uma propriedade `maxDataSize` que pode ser usada para limitar a quantidade de dados armazenados em buffer. Para proteger você contra fluxos `source` inválidos que não reagem a `source.pause()`, esse recurso é habilitado por padrão.

## <a name="api"></a>API

### <a name="delayedstreamcreatesource-options"></a>DelayedStream.create(source, [options])

Retorna um novo `delayedStream`. As opções disponíveis são:

* `pauseStream`
* `maxDataSize`

Veja a descrição dessas propriedades abaixo.

### <a name="delayedstreamsource"></a>delayedStream.source

O fluxo `source` gerenciado por esse objeto. Essa opção é útil quando você está passando o `delayedStream` e ainda quer acessar propriedades no objeto `source`.

### <a name="delayedstreampausestream--true"></a>delayedStream.pauseStream = true

Se deseja pausar o `source` subjacente ao chamar `DelayedStream.create()`. A modificação posterior dessa propriedade não tem nenhum efeito.

### <a name="delayedstreammaxdatasize--1024--1024"></a>delayedStream.maxDataSize = 1024 * 1024

A quantidade de dados a serem armazenados em buffer antes da emissão de um `error`.

Se a origem subjacente estiver emitindo objetos `Buffer`, o `maxDataSize` será medido em bytes.

Se a origem subjacente estiver emitindo objetos JavaScript, o tamanho será medido em caracteres.

Se você souber o que está fazendo, poderá definir essa propriedade como `Infinity` para desabilitar esse recurso. Você também pode modificar essa propriedade durante o tempo de execução.

### <a name="delayedstreamdatasize--0"></a>delayedStream.dataSize = 0

A quantidade de dados armazenados em buffer até agora.

### <a name="delayedstreamreadable"></a>delayedStream.readable

Um getter ECMA5 que retorna o valor de `source.readable`.

### <a name="delayedstreamresume"></a>delayedStream.resume()

Se o `delayedStream` não tiver sido liberado até agora, `delayedStream.release()` será chamado.

Em ambos os casos, `source.resume()` é chamado.

### <a name="delayedstreampause"></a>delayedStream.pause()

Chama `source.pause()`.

### <a name="delayedstreampipedest"></a>delayedStream.pipe(dest)

Chama `delayedStream.resume()` e depois aplica proxy aos argumentos para `source.pipe`.

### <a name="delayedstreamrelease"></a>delayedStream.release()

Emite e limpa todos os eventos que foram armazenados em buffer até agora. Essa opção não retoma a origem subjacente. Nesse caso, use `delayedStream.resume()`.

## <a name="license"></a>Licença

O delayed-stream está licenciado com a licença MIT.
