---
ms.openlocfilehash: 50690c00791b1f6ca1d585c1fb653f0ec4794578
ms.sourcegitcommit: e739004291428ce83f14b9d49f1e9dfaa3762dde
ms.translationtype: HT
ms.contentlocale: pt-BR
ms.lasthandoff: 02/05/2022
ms.locfileid: "138050366"
---
# <a name="prebuild-install"></a>prebuild-install

> **Uma ferramenta de linha de comando para instalar binários predefinidos facilmente para várias versões do Node.js e do Electron em uma plataforma específica.**
> Por padrão, ele baixa binários predefinidos de uma versão do GitHub.

[![npm](https://img.shields.io/npm/v/prebuild-install.svg)](https://www.npmjs.com/package/prebuild-install)
![Versão do Node](https://img.shields.io/node/v/prebuild-install.svg)
[![Teste](https://github.com/prebuild/prebuild-install/actions/workflows/test.yml/badge.svg)](https://github.com/prebuild/prebuild-install/actions/workflows/test.yml)
[![david](https://david-dm.org/prebuild/prebuild-install.svg)](https://david-dm.org/prebuild/prebuild-install)
[![js-standard-style](https://img.shields.io/badge/code%20style-standard-brightgreen.svg)](http://standardjs.com/)

## <a name="note"></a>Observação

**Em vez de [`prebuild`](https://github.com/prebuild/prebuild) emparelhado com [`prebuild-install`](https://github.com/prebuild/prebuild-install), é recomendável [`prebuildify`](https://github.com/prebuild/prebuildify) emparelhado com [`node-gyp-build`](https://github.com/prebuild/node-gyp-build).**

Com `prebuildify`, todos os binários predefinidos são enviados dentro do pacote publicado no npm, o que significa que não há necessidade de uma etapa de download separada, como ocorre em `prebuild`. A ironia dessa abordagem é que é mais rápido baixar todos os binários predefinidos de cada plataforma quando eles estão empacotados do que baixar um só binário predefinido como um script de instalação.

Vantagens:

1. Nenhuma etapa extra de download, tornando-o mais confiável e rápido de ser instalado.
2. Dá suporte à alteração de versões de runtime localmente e ao uso da mesma instalação entre o Node.js e o Electron. A reinstalação ou a recompilação não são necessárias, pois todos os binários predefinidos estão no tarball do npm e o correto é simplesmente escolhido no runtime.
3. A dependência de runtime `node-gyp-build` é livre de dependências e permanecerá assim, pois a introdução de dependências impediria um tempo de instalação mais curto.
4. Os binários predefinidos funcionam mesmo quando os scripts de instalação do npm estão desabilitados.
5. A soma de verificação do pacote npm também abrange binários predefinidos.

Desvantagens:

1. O pacote npm instalado é maior no disco. O uso de [Node-API](https://nodejs.org/api/n-api.html) alivia isso porque os binários que não são da Node-API são independentes do runtime e compatíveis com novas versões.
2. A publicação é um pouco mais complicada, pois `npm publish` precisa ser executado após a compilação e a busca de binários predefinidos (normalmente em CI).

## <a name="usage"></a>Uso

Use [`prebuild`](https://github.com/prebuild/prebuild) para criar e carregar binários predefinidos. Depois, altere o script de instalação package.json para:

```json
{
  "scripts": {
    "install": "prebuild-install || node-gyp rebuild"
  }
}
```

### <a name="help"></a>Ajuda

```
prebuild-install [options]

  --download    -d  [url]       (download prebuilds, no url means github)
  --target      -t  version     (version to install for)
  --runtime     -r  runtime     (Node runtime [node, napi or electron] to build or install for, default is node)
  --path        -p  path        (make a prebuild-install here)
  --token       -T  gh-token    (github token for private repos)
  --arch            arch        (target CPU architecture, see Node OS module docs, default is current arch)
  --platform        platform    (target platform, see Node OS module docs, default is current platform)
  --tag-prefix <prefix>         (github tag prefix, default is "v")
  --build-from-source           (skip prebuild download)
  --verbose                     (log verbosely)
  --libc                        (use provided libc rather than system default)
  --debug                       (set Debug or Release configuration)
  --version                     (print prebuild-install version and exit)
```

Quando `prebuild-install` é executado por meio de um script `npm`, as opções `--build-from-source`, `--debug`, `--download`, `--target`, `--runtime`, `--arch` e `--platform` podem ser passadas por meio de argumentos fornecidos ao comando `npm`.

Como alternativa, você pode definir as variáveis de ambiente `npm_config_build_from_source=true`, `npm_config_platform`, `npm_config_arch`, `npm_config_target` e `npm_config_runtime`.

### <a name="private-repositories"></a>Repositórios privados

O `prebuild-install` dá suporte ao download de prebuilds de repositórios privados do GitHub usando o `-T <github-token>`:

```
$ prebuild-install -T <github-token>
```

Se você não quiser usar o token na CLI, coloque-o em `~/.prebuild-installrc`:

```
token=<github-token>
```

Como alternativa, você pode especificá-lo na variável de ambiente `prebuild-install_token`.

Observe que o uso de um token do GitHub usa a API para resolver a versão correta, o que significa que você está sujeito ao ([limite de taxa do GitHub](https://developer.github.com/v3/rate_limit/)).

### <a name="create-github-token"></a>Criar token do GitHub

Para criar um token:

- Acesse [esta página](https://github.com/settings/tokens)
- Clique no botão `Generate new token`
- Dê um nome ao token e clique no botão `Generate token`, confira abaixo

![prebuild-token](https://cloud.githubusercontent.com/assets/13285808/20844584/d0b85268-b8c0-11e6-8b08-2b19522165a9.png)

Os escopos padrão podem ser usados sem problemas.

### <a name="custom-binaries"></a>Binários personalizados

O usuário final pode substituir o local de download de binário por meio de variáveis de ambiente no arquivo .npmrc.
A variável precisa atender à máscara `% your package name %_binary_host` ou `% your package name %_binary_host_mirror`. Por exemplo:

```
leveldown_binary_host=http://overriden-host.com/overriden-path
```

Observe que o subcaminho da versão do pacote e o nome do arquivo ainda serão acrescentados.
Portanto, se você estiver instalando `leveldown@1.2.3`, a URL resultante será:

```
http://overriden-host.com/overriden-path/v1.2.3/leveldown-v1.2.3-node-v57-win32-x64.tar.gz
```

#### <a name="local-prebuilds"></a>Prebuilds locais

Se você quiser usar prebuilds do sistema de arquivos local, use a variável `% your package name %_local_prebuilds` do .npmrc para definir um caminho para a pasta que contém os prebuilds. Por exemplo:

```
leveldown_local_prebuilds=/path/to/prebuilds
```

Essa opção vai procurar diretamente nessa pasta os pacotes criados com `prebuild`, por exemplo:

```
/path/to/prebuilds/leveldown-v1.2.3-node-v57-win32-x64.tar.gz
```

Caminhos não absolutos são resolvidos em relação ao diretório do pacote que invoca prebuild-install, por exemplo, para dependências aninhadas.

### <a name="cache"></a>Cache

Todos os binários predefinidos são armazenados em cache para minimizar o tráfego. Portanto, primeiro `prebuild-install` seleciona binários do cache e, se nenhum binário for encontrado, ele será baixado. Dependendo do ambiente, a pasta de cache é determinada na seguinte ordem:

- `${npm_config_cache}/_prebuilds`
- `${APP_DATA}/npm-cache/_prebuilds`
- `${HOME}/.npm/_prebuilds`

## <a name="license"></a>Licença

MIT
