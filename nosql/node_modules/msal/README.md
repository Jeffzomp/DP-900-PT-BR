---
ms.openlocfilehash: 4f36d4681facd228c63b48050973040e9785d30f
ms.sourcegitcommit: e739004291428ce83f14b9d49f1e9dfaa3762dde
ms.translationtype: HT
ms.contentlocale: pt-BR
ms.lasthandoff: 02/05/2022
ms.locfileid: "138050246"
---

<a name="microsoft-authentication-library-for-javascript-msaljs"></a>Biblioteca de Autenticação da Microsoft para JavaScript (MSAL.js)
=========================================================

| [Introdução](https://docs.microsoft.com/azure/active-directory/develop/guidedsetups/active-directory-javascriptspa)| [Documentação do AAD](https://aka.ms/aaddevv2) | [Referência de biblioteca](https://azuread.github.io/microsoft-authentication-library-for-js/ref/modules/_azure_msal.html) | [Suporte](README.md#community-help-and-support) | [Amostras](https://github.com/AzureAD/microsoft-authentication-library-for-js/wiki/Samples)
| --- | --- | --- | --- | --- |

⚠️⚠️⚠️ Essa biblioteca não está mais recebendo novos recursos e receberá apenas correções críticas de bug e de segurança. Os novos aplicativos devem usar a [@azure/msal-browser](https://www.npmjs.com/package/@azure/msal-browser). ⚠️⚠️⚠️

A MSAL para JavaScript permite que aplicativos Web JavaScript do lado do cliente, em execução em um navegador da Web, autentiquem usuários usando contas corporativas e de estudante do [AAD](https://docs.microsoft.com/azure/active-directory/develop/v2-overview) (Azure AD), MSA (contas pessoais Microsoft) e provedores de identidade social como Facebook, Google, LinkedIn, contas Microsoft e outros por meio do serviço [Azure AD B2C](https://docs.microsoft.com/azure/active-directory-b2c/active-directory-b2c-overview#identity-providers). Ela também permite que o aplicativo obtenha tokens para acessar serviços do [Microsoft Cloud](https://www.microsoft.com/enterprise), como o [Microsoft Graph](https://graph.microsoft.io).

[![versão do npm](https://img.shields.io/npm/v/msal.svg?style=flat)](https://www.npmjs.com/package/msal)
[![versão do npm](https://img.shields.io/npm/dm/msal.svg)](https://nodei.co/npm/msal/)
[![codecov](https://codecov.io/gh/AzureAD/microsoft-authentication-library-for-js/branch/dev/graph/badge.svg?flag=msal-core)](https://codecov.io/gh/AzureAD/microsoft-authentication-library-for-js)

## <a name="installation"></a>Instalação

### <a name="via-npm"></a>Via NPM:

    npm install msal

## <a name="via-cdn"></a>Via CDN:

<!-- CDN_LATEST -->
```html
<script type="text/javascript" src="https://alcdn.msauth.net/lib/1.4.11/js/msal.min.js"></script>
```

[Detalhes completos e práticas recomendadas](https://github.com/AzureAD/microsoft-authentication-library-for-js/blob/dev/lib/msal-core/docs/cdn.md) para uso da CDN estão disponíveis na documentação.

## <a name="what-to-expect-from-this-library"></a>O que esperar dessa biblioteca
O suporte da MSAL para JavaScript é uma coleção de bibliotecas. `msal-core` ou simplesmente `msal` é a biblioteca principal independente da estrutura. Depois que a 1.x ou superior principal estiver estabilizada, incluiremos na biblioteca `msal-angular` as melhorias mais recentes da 1.x.  Estamos planejando preterir o suporte à `msal-angularjs` com base nas tendências de uso da estrutura e na biblioteca que indica o aumento da adoção do Angular 2 ou superior em vez do Angular 1x. Depois que nossas bibliotecas atuais estiverem em conformidade com os padrões, começaremos a equilibrar novas solicitações de recursos, com novas plataformas, como `react` e `node.js`.

Nossa meta é garantir a comunicação perfeita com a comunidade e considerar as opiniões que ela oferece. Queremos chegar a um agendamento mensal de lançamento secundário, com patches lançados sempre que necessário.  O nível de comunicação, planejamento e granularidade que queremos obter será um trabalho em andamento.

Verifique o [roteiro](https://github.com/AzureAD/microsoft-authentication-library-for-js/wiki#roadmap) para ver no que estamos trabalhando e o que virá a seguir.

## <a name="oauth-20-and-the-implicit-flow"></a>OAuth 2.0 e o fluxo implícito

A MSAL implementa o [fluxo de concessão implícita](https://docs.microsoft.com/azure/active-directory/develop/v2-oauth2-implicit-grant-flow), conforme a definição do protocolo OAuth 2.0 e é compatível com o [OpenID](https://docs.microsoft.com/azure/active-directory/develop/v2-protocols-oidc).

Nossa meta é que a biblioteca elimine suficientemente o protocolo para permitir a autenticação plug-and-play, mas é importante conhecer e entender o fluxo implícito da perspectiva de segurança.
O fluxo implícito é executado no contexto de um navegador da Web que não pode gerenciar segredos do cliente com segurança. Ele é otimizado para aplicativos de página única e tem um salto a menos entre o cliente e o servidor para que os tokens sejam retornados diretamente ao navegador. Esses aspectos fazem com que ele seja menos seguro por natureza.
Essas preocupações de segurança são atenuadas por práticas padrão, como o uso de tokens de curta duração (e, portanto, sem retornar um token de atualização), a biblioteca que exige um URI de redirecionamento registrado para o aplicativo, a biblioteca que corresponde a solicitação e a resposta a um parâmetro de estado e nonce exclusivos.

## <a name="cache-storage"></a>Armazenamento de cache

Oferecemos dois métodos de armazenamento para MSAL, `localStorage` e `sessionStorage`.  Recomendamos o uso da opção `sessionStorage` que é mais segura para o armazenamento de tokens adquiridos pelos usuários, mas a `localStorage` oferece logon único em guias e sessões de usuário.  Solicitamos que você explore as opções e tome a melhor decisão para o aplicativo.

### <a name="forcerefresh-to-skip-cache"></a>forceRefresh para ignorar o cache
Se você quiser ignorar um token em cache e acessar o servidor, passe o booliano `forceRefresh` para o objeto `AuthenticationParameters` usado para fazer uma solicitação de logon/token. **AVISO:** essa opção não deve ser usada por padrão devido ao impacto no desempenho do aplicativo.  A dependência do cache oferecerá aos usuários uma experiência aprimorada e o cache só deverá ser ignorado em cenários em que você saiba que os dados atuais armazenados em cache não têm informações atualizadas.  Exemplo: ferramenta de administração para adicionar funções a um usuário que precisa obter um novo token com funções atualizadas.

## <a name="usage"></a>Uso
O exemplo abaixo explica como fazer logon de um usuário e adquirir um token a ser usado para a API do Graph da Microsoft.

#### <a name="prerequisites"></a>Pré-requisitos

Antes de usar a MSAL.js você precisará [registrar um aplicativo no Azure AD](https://docs.microsoft.com/azure/active-directory/develop/quickstart-register-app) para obter uma `clientId` válida para a configuração e para registrar as rotas em que o aplicativo aceitará encaminhar o tráfego.

#### <a name="1-instantiate-the-useragentapplication"></a>1. Criar uma instância de UserAgentApplication

`UserAgentApplication` pode ser configurado com uma variedade de opções diferentes, detalhadas no [Wiki](https://github.com/AzureAD/microsoft-authentication-library-for-js/wiki/MSAL.js-1.0.0-api-release#configuration-options), mas o único parâmetro necessário é `auth.clientId`.

Depois de criar a instância, se você planeja usar um fluxo de redirecionamento na MSAL 1.2.x ou anterior (`loginRedirect` e `acquireTokenRedirect`), registre um manipulador de retorno de chamada usando `handleRedirectCallback(authCallback)` em que `authCallback = function(AuthError, AuthResponse)`. A partir da MSAL 1.3.0, isso é opcional. A função de retorno de chamada é chamada depois que a solicitação de autenticação é concluída com êxito ou com falha. Isso não é necessário para os fluxos pop-up, pois eles retornam promessas.

```JavaScript
    import * as Msal from "msal";
    // if using cdn version, 'Msal' will be available in the global scope

    const msalConfig = {
        auth: {
            clientId: 'your_client_id'
        }
    };

    const msalInstance = new Msal.UserAgentApplication(msalConfig);

    msalInstance.handleRedirectCallback((error, response) => {
        // handle redirect response or error
    });

```

Para obter detalhes sobre as opções de configuração, leia [Inicialização de aplicativos cliente com a MSAL.js](https://docs.microsoft.com/azure/active-directory/develop/msal-js-initializing-client-applications).

#### <a name="2-login-the-user"></a>2. Fazer logon do usuário

O aplicativo precisa fazer logon do usuário com o método `loginPopup` ou `loginRedirect` para estabelecer o contexto do usuário.

Quando os métodos de logon são chamados e a autenticação do usuário é concluída pelo serviço do Azure AD, é retornado um [token de ID](https://docs.microsoft.com/azure/active-directory/develop/id-tokens), que é usado para identificar o usuário com algumas informações básicas.

Ao fazer logon de um usuário, você pode passar escopos com os quais o usuário pode consentir previamente no logon, mas isso não é necessário. Observe que consentir com escopos no logon não retorna um access_token para esses escopos, mas oferece a oportunidade de obter um token silenciosamente com esses escopos passados, sem nenhuma interação adicional do usuário.

Uma prática recomendada é solicitar apenas os escopos necessários quando precisar deles, um conceito chamado consentimento dinâmico. Além dessa opção criar um consentimento mais interativo para os usuários no aplicativo, ela também reduz a perda de usuários que possam se incomodar em conceder uma ampla lista de permissões para recursos que ainda não estejam usando.

O AAD só permitirá que você obtenha consentimento para três recursos por vez, embora seja possível solicitar vários escopos dentro de um recurso.
Quando o usuário faz uma solicitação de logon, você pode passar vários recursos e os escopos correspondentes porque o AAD emite um idToken de consentimento prévio com esses escopos. No entanto, as chamadas a acquireToken são válidas apenas para um recurso/vários escopos. Se você precisar acessar vários recursos, faça chamadas acquireToken separadas por recurso.

```JavaScript
   var loginRequest = {
       scopes: ["user.read", "mail.send"] // optional Array<string>
   };

    msalInstance.loginPopup(loginRequest)
        .then(response => {
            // handle response
        })
        .catch(err => {
            // handle error
        });

```

##### <a name="ssosilent"></a>ssoSilent

Se você tem certeza de que o usuário tem uma sessão existente e quer estabelecer o contexto do usuário sem solicitar interação, invoque `ssoSilent` com um `loginHint` ou `sid` (disponível como uma [declaração opcional](https://docs.microsoft.com/azure/active-directory/develop/active-directory-optional-claims)) e a MSAL tentará usar o SSO silenciosamente na sessão existente e estabelecer o contexto do usuário.

Observe que, se não houver nenhuma sessão ativa para o determinado `loginHint` ou `sid`, será gerado um erro, que deverá ser tratado invocando um método de logon interativo (`loginPopup` ou `loginRedirect`).

Exemplo:

```js
const ssoRequest = {
    loginHint: "user@example.com"
};

msalInstance.ssoSilent(ssoRequest)
    .then(response => {
        // session silently established
    })
    .catch(error => {
        // handle error by invoking an interactive login method
        msalInstance.loginPopup(ssoRequest);
    });
```

#### <a name="3-get-an-access-token-to-call-an-api"></a>3. Obter um token de acesso para chamar uma API

Na MSAL, você pode obter tokens de acesso para as APIs que o aplicativo precisa chamar usando o método `acquireTokenSilent` que faz uma solicitação silenciosa (sem interagir com o usuário usando uma interface do usuário) ao Azure AD para obter um token de acesso. Depois, o serviço Azure AD retorna um [token de acesso](https://docs.microsoft.com/azure/active-directory/develop/access-tokens) que contém os escopos consentidos pelo usuário para permitir que o aplicativo chame a API com segurança.

Você pode usar `acquireTokenRedirect` ou `acquireTokenPopup` iniciar solicitações interativas, embora a prática recomendada seja mostrar as experiências interativas apenas se não for possível obter um token silenciosamente devido a erros necessários de interação. Se você estiver usando uma chamada de token interativa, ela deverá corresponder ao método de logon usado no aplicativo. (`loginPopup`=> `acquireTokenPopup`, `loginRedirect` => `acquireTokenRedirect`).

Se a chamada `acquireTokenSilent` falhar com um erro do tipo `InteractionRequiredAuthError`, você precisará iniciar uma solicitação interativa.  Isso pode acontecer por vários motivos, incluindo escopos que foram revogados, tokens expirados ou alterações de senha.

O `acquireTokenSilent` vai procurar um token válido no cache e, se o token estiver perto de expirar ou não existir, ele vai tentar atualizá-lo automaticamente para você.

Confira [Tipos de dados de solicitação e resposta](https://github.com/AzureAD/microsoft-authentication-library-for-js/wiki/MSAL.js-1.0.0-api-release#signing-in-and-getting-tokens-with-msaljs) como referência.

```JavaScript
    // if the user is already logged in you can acquire a token
    if (msalInstance.getAccount()) {
        var tokenRequest = {
            scopes: ["user.read", "mail.send"]
        };
        msalInstance.acquireTokenSilent(tokenRequest)
            .then(response => {
                // get access token from response
                // response.accessToken
            })
            .catch(err => {
                // could also check if err instance of InteractionRequiredAuthError if you can import the class.
                if (err.name === "InteractionRequiredAuthError") {
                    return msalInstance.acquireTokenPopup(tokenRequest)
                        .then(response => {
                            // get access token from response
                            // response.accessToken
                        })
                        .catch(err => {
                            // handle error
                        });
                }
            });
    } else {
        // user is not logged in, you will need to log them in to acquire a token
    }
```

#### <a name="4-use-the-token-as-a-bearer-in-an-http-request-to-call-the-microsoft-graph-or-a-web-api"></a>4. Use o token como portador em uma solicitação HTTP para chamar o Microsoft Graph ou uma API Web

```JavaScript
    var headers = new Headers();
    var bearer = "Bearer " + token;
    headers.append("Authorization", bearer);
    var options = {
         method: "GET",
         headers: headers
    };
    var graphEndpoint = "https://graph.microsoft.com/v1.0/me";

    fetch(graphEndpoint, options)
        .then(resp => {
             //do something with response
        });
```

Saiba mais detalhes sobre a funcionalidade da MSAL.js documentada no [Wiki da MSAL](https://github.com/AzureAD/microsoft-authentication-library-for-js/wiki) e veja [exemplos de código completos](https://github.com/AzureAD/microsoft-authentication-library-for-js/wiki/Samples).

## <a name="security-reporting"></a>Relatório de segurança

Se você encontrar um problema de segurança com nossas bibliotecas ou serviços, relate-os para [secure@microsoft.com](mailto:secure@microsoft.com) com o máximo de detalhes possível. Seu envio pode ser qualificado para uma recompensa por meio do programa [Microsoft Bounty](http://aka.ms/bugbounty). Não poste problemas de segurança nos Problemas do GitHub nem em outros sites públicos. Entraremos em contato com você logo após receber as informações. Recomendamos que você obtenha notificações sobre a ocorrência de incidentes de segurança visitando [esta página](https://technet.microsoft.com/security/dd252948) e assinando os alertas do Security Advisory.

## <a name="license"></a>Licença

Copyright (c) Microsoft Corporation.  Todos os direitos reservados. Licenciado com a licença MIT (a "Licença");

## <a name="we-value-and-adhere-to-the-microsoft-open-source-code-of-conduct"></a>Valorizamos e seguimos o Código de Conduta de Software Livre da Microsoft

Este projeto adotou o [Código de Conduta de Software Livre da Microsoft](https://opensource.microsoft.com/codeofconduct/). Para obter mais informações, confira as [Perguntas frequentes sobre o código de conduta](https://opensource.microsoft.com/codeofconduct/faq/) ou entre em contato com [opencode@microsoft.com](mailto:opencode@microsoft.com) para enviar outras perguntas ou comentários.
