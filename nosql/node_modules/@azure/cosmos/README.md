---
ms.openlocfilehash: 3e62289181d994a0e786bb53417f576ac1a3059b
ms.sourcegitcommit: e739004291428ce83f14b9d49f1e9dfaa3762dde
ms.translationtype: HT
ms.contentlocale: pt-BR
ms.lasthandoff: 02/05/2022
ms.locfileid: "138050324"
---
# <a name="azure-cosmos-db-client-library-for-javascripttypescript"></a>Biblioteca de clientes do Azure Cosmos DB para JavaScript/TypeScript

[![selo mais recente do npm](https://img.shields.io/npm/v/%40azure%2Fcosmos/latest.svg)][npm]
[![Status de build](https://dev.azure.com/azure-sdk/public/_apis/build/status/js/js%20-%20cosmosdb%20-%20ci?branchName=main)](https://dev.azure.com/azure-sdk/public/_build/latest?definitionId=850&branchName=main)

O Azure Cosmos DB é um serviço de banco de dados multimodelo globalmente distribuído que dá suporte a bancos de dados de documentos, valor-chave, coluna larga e grafo. Este pacote destina-se a aplicativos JavaScript/Typescript para interagir com os bancos de dados da **API de SQL** e os documentos JSON que eles contêm:

- Criar bancos de dados do Cosmos DB e modificar as configurações
- Criar e modificar contêineres para armazenar coleções de documentos JSON
- Criar, ler, atualizar e excluir os itens (documentos JSON) nos contêineres
- Consultar os documentos no banco de dados usando uma sintaxe semelhante à SQL

Links principais:

- [Pacote (npm)][npm]
- [Documentação de referência da API](https://docs.microsoft.com/javascript/api/@azure/cosmos/?view=azure-node-lates)
- [Documentação do produto][cosmos_docs]

## <a name="getting-started"></a>Introdução

### <a name="prerequisites"></a>Pré-requisitos

#### <a name="azure-subscription-and-cosmos-db-sql-api-account"></a>Assinatura do Azure e conta da API de SQL do Cosmos DB

Você precisa ter uma [Assinatura do Azure][azure_sub] e uma [conta do Cosmos DB][cosmos_account] (API de SQL) para usar este pacote.

Se você precisar de uma conta da API de SQL do Cosmos DB, use o [Azure Cloud Shell][cloud_shell_bash] para criar uma com este comando da CLI do Azure:

```Bash
az cosmosdb create --resource-group <resource-group-name> --name <cosmos-database-account-name>
```

Ou você pode criar uma conta no [portal do Azure](https://portal.azure.com/#create/microsoft.documentdb)

#### <a name="nodejs"></a>NodeJS

Este pacote é distribuído pelo [npm][npm] que vem pré-instalado com [o Node.js](https://nodejs.org/en/). Use o Node v10 ou superior.

#### <a name="cors"></a>CORS

Você precisará configurar regras de [CORS (Compartilhamento de Recursos entre Origens)](https://docs.microsoft.com/azure/cosmos-db/how-to-configure-cross-origin-resource-sharing) para a conta do Cosmos DB se precisar desenvolver para navegadores. Siga as instruções no documento vinculado para criar regras de CORS para o Cosmos DB.

### <a name="install-this-package"></a>Instalar este pacote

```Bash
npm install @azure/cosmos
```

### <a name="get-account-credentials"></a>Obter credenciais da conta

Você precisará do **ponto de extremidade** e da **chave** da conta do Cosmos DB. Encontre-os no [portal do Azure](https://portal.azure.com/#blade/hubsextension/browseresource/resourcetype/microsoft.documentdb%2fdatabaseaccounts) ou usar o snippet da [CLI do Azure][azure_cli] abaixo. O snippet é formatado para o shell do Bash.

```Bash
az cosmosdb show --resource-group <your-resource-group> --name <your-account-name> --query documentEndpoint --output tsv
az cosmosdb keys list --resource-group <your-resource-group> --name <your-account-name> --query documentEndpoint --output tsv
```

### <a name="create-an-instance-of-cosmosclient"></a>Criar uma instância de `CosmosClient`

A interação com o Cosmos BD começa com uma instância da classe [CosmosClient](https://docs.microsoft.com/javascript/api/@azure/cosmos/cosmosclient?view=azure-node-latest)

```js
const { CosmosClient } = require("@azure/cosmos");

const endpoint = "https://your-account.documents.azure.com";
const key = "<database account masterkey>";
const client = new CosmosClient({ endpoint, key });

async function main() {
  // The rest of the README samples are designed to be pasted into this function body
}

main().catch((error) => {
  console.error(error);
});
```

Para simplificar, incluímos `key` e `endpoint` diretamente no código, mas você pode carregá-los de um arquivo que não esteja no controle do código-fonte usando um projeto como [dotenv](https://www.npmjs.com/package/dotenv) ou carregando de variáveis de ambiente

Em ambientes de produção, segredos como chaves devem ser armazenados no [Azure Key Vault](https://azure.microsoft.com/services/key-vault/)

## <a name="key-concepts"></a>Principais conceitos

Depois de inicializar um [CosmosClient](https://docs.microsoft.com/javascript/api/@azure/cosmos/cosmosclient?view=azure-node-lates), você pode interagir com os tipos de recursos primários no Cosmos DB:

- [Banco de dados](https://docs.microsoft.com/javascript/api/@azure/cosmos/database?view=azure-node-latest): Uma conta do Cosmos DB pode conter vários bancos de dados. Ao criar um banco de dados, você especifica a API que quer usar para interagir com os respectivos documentos: SQL, MongoDB, Gremlin, Cassandra ou Tabelas do Azure. Use o objeto de [banco de dados](https://docs.microsoft.com/javascript/api/@azure/cosmos/database?view=azure-node-latest) para gerenciar os respectivos contêineres.

- [Contêiner](https://docs.microsoft.com/javascript/api/@azure/cosmos/container?view=azure-node-latest): Um contêiner é uma coleção de documentos JSON. Você cria (insere), lê, atualiza e exclui itens em um contêiner usando métodos no objeto de [contêiner](https://docs.microsoft.com/javascript/api/@azure/cosmos/container?view=azure-node-latest).

- [Item](https://docs.microsoft.com/javascript/api/@azure/cosmos/item?view=azure-node-latest): um item é um documento JSON armazenado em um contêiner. Cada item precisa incluir uma chave `id` com um valor que identifique-o exclusivamente dentro do contêiner. Se você não fornecer uma `id`, o SDK vai gerá-la automaticamente.

Para obter mais informações sobre esses recursos, confira [Trabalhar com bancos de dados, contêineres e itens do Azure Cosmos][cosmos_resources].

## <a name="examples"></a>Exemplos

As seguintes seções fornecem vários snippets de código que abrangem algumas das tarefas mais comuns do Cosmos DB, incluindo:

- [Criar um banco de dados](#create-a-database)
- [Criar um contêiner](#create-a-container)
- [Inserir itens](#insert-items)
- [Consultar documentos](#query-the-database)
- [Ler um item](#read-an-item)
- [Excluir um item](#delete-an-data)

### <a name="create-a-database"></a>Criar um banco de dados

Depois de autenticar o [CosmosClient](https://docs.microsoft.com/javascript/api/@azure/cosmos/cosmosclient?view=azure-node-latest), você pode trabalhar com qualquer recurso na conta. O snippet de código abaixo cria um banco de dados da API de SQL.

```js
const { database } = await client.databases.createIfNotExists({ id: "Test Database" });
console.log(database.id);
```

### <a name="create-a-container"></a>Criar um contêiner

Este exemplo cria um contêiner com configurações padrão

```js
const { container } = await database.containers.createIfNotExists({ id: "Test Database" });
console.log(container.id);
```

### <a name="insert-items"></a>Inserir itens

Para inserir itens em um contêiner, passe um objeto contendo os dados para [Items.upsert](https://docs.microsoft.com/javascript/api/@azure/cosmos/items?view=azure-node-latest#upsert-t--requestoptions-). O serviço Cosmos BD requer que cada item tenha uma chave `id`. Se você não fornecer uma `id`, o SDK vai gerá-la automaticamente.

Este exemplo insere vários itens no contêiner

```js
const cities = [
  { id: "1", name: "Olympia", state: "WA", isCapitol: true },
  { id: "2", name: "Redmond", state: "WA", isCapitol: false },
  { id: "3", name: "Chicago", state: "IL", isCapitol: false }
];
for (const city of cities) {
  container.items.create(city);
}
```

### <a name="read-an-item"></a>Ler um item

Para ler um só item de um contêiner, use [Item.read](https://docs.microsoft.com/javascript/api/@azure/cosmos/item?view=azure-node-latest#read-requestoptions-). Essa é uma operação mais simples do que usar SQL para consultar por `id`.

```js
await container.item("1").read();
```

### <a name="delete-an-item"></a>Excluir um item

Para excluir itens de um contêiner, use [Item.delete](https://docs.microsoft.com/javascript/api/@azure/cosmos/item?view=azure-node-latest#delete-requestoptions-).

```js
// Delete the first item returned by the query above
await container.item("1").delete();
```

### <a name="query-the-database"></a>Consultar o banco de dados

Um banco de dados da API de SQL do Cosmos DB dá suporte à consulta dos itens em um contêiner com [Items.query](https://docs.microsoft.com/javascript/api/@azure/cosmos/items?view=azure-node-latest#query-string---sqlqueryspec--feedoptions-) usando uma sintaxe semelhante à SQL:

```js
const { resources } = await container.items
  .query("SELECT * from c WHERE c.isCapitol = true")
  .fetchAll();
for (const city of resources) {
  console.log(`${city.name}, ${city.state} is a capitol `);
}
```

Execute consultas parametrizadas passando um objeto contendo os parâmetros e seus valores para [Items.query](https://docs.microsoft.com/javascript/api/@azure/cosmos/items?view=azure-node-latest#query-string---sqlqueryspec--feedoptions-):

```js
const { resources } = await container.items
  .query({
    query: "SELECT * from c WHERE c.isCapitol = @isCapitol",
    parameters: [{ name: "@isCapitol", value: true }]
  })
  .fetchAll();
for (const city of resources) {
  console.log(`${city.name}, ${city.state} is a capitol `);
}
```

Para obter mais informações de como consultar bancos de dados do Cosmos BD usando a API de SQL, confira [Consultar dados do Azure Cosmos DB com consultas SQL][cosmos_sql_queries].

## <a name="troubleshooting"></a>Solução de problemas

### <a name="general"></a>Geral

Quando você interage com o Cosmos DB, os erros retornados pelo serviço correspondem aos mesmos códigos de status HTTP retornados para as solicitações da API REST:

[Códigos de status HTTP para o Azure Cosmos DB][cosmos_http_status_codes]

#### <a name="conflicts"></a>Conflitos

Por exemplo, se você tentar criar um item usando um `id` que já esteja em uso no banco de dados do Cosmos DB, um erro `409` será retornado, indicando o conflito. No snippet a seguir, o erro é tratado normalmente capturando a exceção e exibindo informações adicionais sobre o erro.

```js
try {
  await containers.items.create({ id: "existing-item-id" });
} catch (error) {
  if (error.code === 409) {
    console.log("There was a conflict with an existing item");
  }
}
```

### <a name="transpiling"></a>Transpilação

Os SDKs do Azure foram projetados para dar suporte à sintaxe ES5 JavaScript e a [versões LTS do Node.js](https://nodejs.org/about/releases/). Se você precisar de suporte para runtimes do JavaScript anteriores, como o Internet Explorer ou o Node 6, será necessário transpilar o código do SDK durante o processo de build.

### <a name="handle-transient-errors-with-retries"></a>Tratar erros transitórios com novas tentativas

Ao trabalhar com o Cosmos DB, você poderá encontrar falhas transitórias causadas por [limites de taxa][cosmos_request_units] impostos pelo serviço ou outros problemas transitórios, como interrupções de rede. Para obter informações sobre como lidar com esses tipos de falhas, confira [Padrão de repetição][azure_pattern_retry] no guia Padrões de Design de Nuvem e o [padrão de Disjuntor][azure_pattern_circuit_breaker] relacionado.

## <a name="next-steps"></a>Próximas etapas

### <a name="more-sample-code"></a>Mais códigos de exemplo

Há [vários exemplos][cosmos_samples] disponíveis para você no repositório do SDK no GitHub. Esses exemplos fornecem códigos de exemplo para cenários adicionais que geralmente são encontrados ao trabalhar com o Cosmos DB:

- Operações de Banco de dados
- Operações de Contêiner
- Operações de item
- Configuração da indexação
- Leitura do feed de alterações de um contêiner
- Procedimentos armazenados
- Alteração das configurações de taxa de transferência de banco de dados/contêiner
- Operações de gravação em várias regiões

### <a name="additional-documentation"></a>Documentação adicional

Para obter uma documentação mais abrangente sobre o serviço Cosmos BD, confira a [documentação do Azure Cosmos DB][cosmos_docs] em docs.microsoft.com.

## <a name="useful-links"></a>Links úteis

- [Bem-vindo(a) ao Azure Cosmos DB](https://docs.microsoft.com/azure/cosmos-db/community)
- [Início rápido](https://docs.microsoft.com/azure/cosmos-db/sql-api-nodejs-get-started)
- [Tutorial](https://docs.microsoft.com/azure/cosmos-db/sql-api-nodejs-application)
- [Amostras](https://github.com/Azure/azure-sdk-for-js/tree/main/sdk/cosmosdb/cosmos/samples)
- [Introdução ao modelo de recurso do serviço Azure Cosmos DB](https://docs.microsoft.com/azure/cosmos-db/sql-api-resources)
- [Introdução à API de SQL do serviço Azure Cosmos DB](https://docs.microsoft.com/azure/cosmos-db/sql-api-sql-query)
- [Particionamento](https://docs.microsoft.com/azure/cosmos-db/sql-api-partition-data)
- [Documentação da API](https://docs.microsoft.com/javascript/api/%40azure/cosmos/?view=azure-node-latest)

## <a name="contributing"></a>Contribuição

Se você quiser contribuir com essa biblioteca, leia o [guia de contribuição](https://github.com/Azure/azure-sdk-for-js/blob/main/CONTRIBUTING.md) para saber como criar e testar o código.

![Impressões](https://azure-sdk-impressions.azurewebsites.net/api/impressions/azure-sdk-for-js%2Fsdk%2Fcosmosdb%2Fcosmos%2FREADME.png)

<!-- LINKS -->

[azure_cli]: https://docs.microsoft.com/cli/azure
[azure_pattern_circuit_breaker]: https://docs.microsoft.com/azure/architecture/patterns/circuit-breaker
[azure_pattern_retry]: https://docs.microsoft.com/azure/architecture/patterns/retry
[azure_portal]: https://portal.azure.com
[azure_sub]: https://azure.microsoft.com/free/
[cloud_shell]: https://docs.microsoft.com/azure/cloud-shell/overview
[cloud_shell_bash]: https://shell.azure.com/bash
[cosmos_account_create]: https://docs.microsoft.com/azure/cosmos-db/how-to-manage-database-account
[cosmos_account]: https://docs.microsoft.com/azure/cosmos-db/account-overview
[cosmos_container]: https://docs.microsoft.com/azure/cosmos-db/databases-containers-items#azure-cosmos-containers
[cosmos_database]: https://docs.microsoft.com/azure/cosmos-db/databases-containers-items#azure-cosmos-databases
[cosmos_docs]: https://docs.microsoft.com/azure/cosmos-db/
[cosmos_http_status_codes]: https://docs.microsoft.com/rest/api/cosmos-db/http-status-codes-for-cosmosdb
[cosmos_item]: https://docs.microsoft.com/azure/cosmos-db/databases-containers-items#azure-cosmos-items
[cosmos_request_units]: https://docs.microsoft.com/azure/cosmos-db/request-units
[cosmos_resources]: https://docs.microsoft.com/azure/cosmos-db/databases-containers-items
[cosmos_samples]: https://github.com/Azure/azure-sdk-for-js/tree/main/sdk/cosmosdb/cosmos/samples
[cosmos_sql_queries]: https://docs.microsoft.com/azure/cosmos-db/how-to-sql-query
[cosmos_ttl]: https://docs.microsoft.com/azure/cosmos-db/time-to-live
[npm]: https://www.npmjs.com/package/@azure/cosmos
