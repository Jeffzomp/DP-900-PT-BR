---
ms.openlocfilehash: 8013ef1413fb83a07c8c31eb731be49ba57bbb66
ms.sourcegitcommit: e739004291428ce83f14b9d49f1e9dfaa3762dde
ms.translationtype: HT
ms.contentlocale: pt-BR
ms.lasthandoff: 02/05/2022
ms.locfileid: "138050380"
---
## <a name="azure-identity-client-library-for-javascript"></a>Biblioteca de clientes da Identidade do Azure para JavaScript

A biblioteca do Azure Identity fornece suporte à autenticação de tokens do Azure Active Directory para o SDK do Azure. Ela fornece um conjunto de implementações de [TokenCredential](https://docs.microsoft.com/javascript/api/@azure/core-auth/tokencredential) que podem ser usadas para construir clientes do SDK do Azure para dar suporte à autenticação de token do AAD.

Veja exemplos dessas várias credenciais na [página de exemplos do Azure Identity](https://github.com/Azure/azure-sdk-for-js/blob/hotfix/identity_1.3.0/sdk/identity/identity/samples/AzureIdentityExamples.md)

[Código-fonte](https://github.com/Azure/azure-sdk-for-js/tree/master/sdk/identity/identity) | [Pacote (npm)](https://www.npmjs.com/package/@azure/identity) | [Documentação de referência da API](https://docs.microsoft.com/javascript/api/@azure/identity) | [Documentação do produto](https://azure.microsoft.com/services/active-directory/) | [Exemplos](https://github.com/Azure/azure-sdk-for-js/blob/master/sdk/identity/identity/samples)

## <a name="getting-started"></a>Introdução

### <a name="currently-supported-environments"></a>Ambientes com suporte no momento

- [Versões LTS do Node.js](https://nodejs.org/about/releases/)
- Versões mais recentes do Safari, Chrome, Edge e Firefox.
  - Observação: Observação: entre as diferentes credenciais exportadas nesta biblioteca, `InteractiveBrowserCredential` é a única compatível com o navegador.

### <a name="install-the-package"></a>Instalar o pacote

Instale o Azure Identity com `npm`:

```sh
npm install --save @azure/identity
```

### <a name="prerequisites"></a>Pré-requisitos

- Node.js 8 LTS ou superior.
- Uma [assinatura do Azure](https://azure.microsoft.com/free/).
- A [CLI do Azure][azure_cli] também pode ser útil para fazer a autenticação em um ambiente de desenvolvimento e gerenciar funções de conta.

### <a name="authenticate-the-client-in-development-environment"></a>Autenticar o cliente no ambiente de desenvolvimento

Embora seja recomendável usar a autenticação de identidade gerenciada ou de entidade de serviço no aplicativo de produção, é comum que um desenvolvedor use a própria conta para autenticar chamadas aos serviços do Azure ao depurar e executar código localmente. Há várias ferramentas de desenvolvedor que podem ser usadas para executar essa autenticação no ambiente de desenvolvimento.

#### <a name="authenticating-via-visual-studio-code"></a>Autenticação pelo Visual Studio Code

Os desenvolvedores que usam o Visual Studio Code podem usar a [Extensão de Conta do Azure](https://marketplace.visualstudio.com/items?itemName=ms-vscode.azure-account) para fazer a autenticação por meio do IDE. Os aplicativos que usam `DefaultAzureCredential` ou `VisualStudioCodeCredential` podem usar essa conta para autenticar chamadas no aplicativo ao serem executados localmente.

Para autenticação no Visual Studio Code, primeiro verifique se a [Extensão de Conta do Azure](https://marketplace.visualstudio.com/items?itemName=ms-vscode.azure-account) está instalada. Depois que a extensão for instalada, pressione `F1` para abrir a paleta de comandos e executar o comando `Azure: Sign In`.

![Entrada na conta do Visual Studio Code][vscodelogincommand_image]

#### <a name="authenticating-via-the-azure-cli"></a>Autenticação por meio da CLI do Azure

Os aplicativos que usam `AzureCliCredential`, diretamente ou com `DefaultAzureCredential`, podem usar a conta da CLI do Azure para autenticar chamadas no aplicativo durante a execução local.

Para fazer a autenticação com a [CLI do Azure][azure_cli], os usuários podem executar o comando `az login`. Para usuários com execução em um sistema com um navegador da Web padrão, a CLI do Azure iniciará o navegador para autenticar o usuário.

![Entrada na conta da CLI do Azure][azureclilogin_image]

Para sistemas sem um navegador da Web padrão, o comando `az login` usará o fluxo de autenticação de código do dispositivo. O usuário também pode forçar a CLI do Azure a usar o fluxo de código do dispositivo em vez de iniciar um navegador especificando o argumento `--use-device-code`.

![Entrada no código do dispositivo da conta da CLI do Azure][azureclilogindevicecode_image]

### <a name="authenticate-the-client-in-browsers"></a>Autenticar o cliente em navegadores

Para autenticar os SDKs do Azure em navegadores da Web, oferecemos o `InteractiveBrowserCredential`no momento, que pode ser definido para usar redirecionamento ou pop-ups para concluir o fluxo de autenticação. Primeiro, é necessário [criar um registro de aplicativo do Azure](https://docs.microsoft.com/azure/active-directory/develop/scenario-spa-app-registration) no portal para o aplicativo Web.

## <a name="key-concepts"></a>Principais conceitos

|Se esta for a primeira vez que você usa o `@azure/identity` ou o plataforma de identidade da Microsoft (Azure Active Directory), recomendamos que primeiro você leia [Como usar o `@azure/identity` com a plataforma de identidade da Microsoft](https://github.com/Azure/azure-sdk-for-js/blob/master/documentation/using-azure-identity.md). Esse documento fornecerá uma compreensão mais profunda da plataforma e de como configurar a conta do Azure corretamente.

### <a name="credentials"></a>Credenciais

Uma credencial é uma classe que contém ou pode obter os dados necessários para um cliente de serviço autenticar solicitações. Os clientes de serviço no SDK do Azure aceitam credenciais quando são construídos e usam essas credenciais para autenticar solicitações para o serviço.

A biblioteca do Azure Identity se concentra-se na autenticação OAuth com Azure Active Directory e oferece várias classes de credenciais que podem adquirir um token do AAD para autenticar solicitações de serviço. Todas as classes de credenciais nesta biblioteca são implementações da classe abstrata [TokenCredential](https://github.com/Azure/azure-sdk-for-js/blob/master/sdk/core/core-auth/src/tokenCredential.ts) e todas elas podem ser usadas por clientes do serviço de construtor que tenham capacidade de autenticação com um TokenCredential.

Confira [Classes de credencial](#credential-classes).

### <a name="defaultazurecredential"></a>DefaultAzureCredential

O `DefaultAzureCredential` é apropriado para a maioria dos cenários em que o aplicativo pretende, em última instância, ser executado no Azure Cloud. Isso ocorre porque o `DefaultAzureCredential` combina as credenciais normalmente usadas para autenticação quando implantada com as credenciais usadas para realizar a autenticação em um ambiente de desenvolvimento. A `DefaultAzureCredential` tentará realizar a autenticação usando os mecanismos a seguir na ordem.

![Fluxo de autenticação DefaultAzureCredential][defaultauthflow_image]

- Ambiente – a `DefaultAzureCredential` lerá as informações de conta especificadas por meio de [variáveis de ambiente](#environment-variables) e as usará para autenticação.
- Identidade gerenciada – se o aplicativo for implantado em um host do Azure com identidade gerenciada habilitada, o `DefaultAzureCredential` será autenticado com essa conta.
- Visual Studio Code – se o desenvolvedor tiver se autenticado por meio do plug-in de conta do Azure Visual Studio Code, o `DefaultAzureCredential` será autenticado com essa conta.
- CLI do Azure – Se o desenvolvedor tiver autenticado uma conta por meio do comando `az login` da CLI do Azure, `DefaultAzureCredential` será autenticado com essa conta.

## <a name="environment-variables"></a>Variáveis de ambiente

`DefaultAzureCredential` e `EnvironmentCredential` podem ser configurados com variáveis de ambiente. Cada tipo de autenticação requer valores para variáveis específicas:

#### <a name="service-principal-with-secret"></a>Entidade de serviço com segredo

| nome da variável         | valor                                                 |
| --------------------- | ----------------------------------------------------- |
| `AZURE_CLIENT_ID`     | ID de um aplicativo do Azure Active Directory           |
| `AZURE_TENANT_ID`     | ID do locatário do Azure Active Directory do aplicativo |
| `AZURE_CLIENT_SECRET` | um dos segredos do cliente do aplicativo               |

#### <a name="service-principal-with-certificate"></a>Entidade de serviço com certificado

| nome da variável                   | valor                                                                                      |
| ------------------------------- | ------------------------------------------------------------------------------------------ |
| `AZURE_CLIENT_ID`               | ID de um aplicativo do Azure Active Directory                                                |
| `AZURE_TENANT_ID`               | ID do locatário do Azure Active Directory do aplicativo                                      |
| `AZURE_CLIENT_CERTIFICATE_PATH` | caminho para um arquivo de certificado codificado em PEM, incluindo a chave privada (sem proteção de senha) |

#### <a name="username-and-password"></a>Nome de usuário e senha

| nome da variável     | valor                                       |
| ----------------- | ------------------------------------------- |
| `AZURE_CLIENT_ID` | ID de um aplicativo do Azure Active Directory |
| `AZURE_USERNAME`  | um nome de usuário (geralmente um endereço de email)       |
| `AZURE_PASSWORD`  | a senha desse usuário                        |

A configuração é tentada na ordem acima. Por exemplo, se os valores para um segredo do cliente e um certificado estiverem presentes, o segredo do cliente será usado.

## <a name="examples"></a>Exemplos

Veja mais exemplos de uso de várias credenciais na [página de exemplos do Azure Identity](https://github.com/Azure/azure-sdk-for-js/blob/hotfix/identity_1.3.0/sdk/identity/identity/samples/AzureIdentityExamples.md)

### <a name="authenticating-with-the-defaultazurecredential"></a>Autenticação com o `DefaultAzureCredential`

Este exemplo demonstra a autenticação do `KeyClient` da biblioteca de clientes [@azure/keyvault-keys](https://www.npmjs.com/package/@azure/keyvault-keys) usando `DefaultAzureCredential`.

```javascript
// The default credential first checks environment variables for configuration as described above.
// If environment configuration is incomplete, it will try managed identity.

// Azure Key Vault service to use
const { KeyClient } = require("@azure/keyvault-keys");

// Azure authentication library to access Azure Key Vault
const { DefaultAzureCredential } = require("@azure/identity");

// Azure SDK clients accept the credential as a parameter
const credential = new DefaultAzureCredential();

// Create authenticated client
const client = new KeyClient(vaultUrl, credential);

// Use service from authenticated client
const getResult = await client.getKey("MyKeyName");
```

### <a name="specifying-a-user-assigned-managed-identity-with-the-defaultazurecredential"></a>Especificação de uma identidade gerenciada atribuída pelo usuário com `DefaultAzureCredential`

Um cenário relativamente comum envolve a autenticação usando uma identidade gerenciada atribuída pelo usuário para um recurso do Azure. Explore o [exemplo de autenticação de uma identidade gerenciada atribuída pelo usuário com DefaultAzureCredential](https://github.com/Azure/azure-sdk-for-js/blob/hotfix/identity_1.3.0/sdk/identity/identity/samples/AzureIdentityExamples.md#authenticating-a-user-assigned-managed-identity-with-defaultazurecredential) para ver como essa é uma tarefa relativamente simples que pode ser configurada usando variáveis de ambiente ou em código.

### <a name="define-a-custom-authentication-flow-with-the-chainedtokencredential"></a>Definir um fluxo de autenticação personalizado com `ChainedTokenCredential`

Embora `DefaultAzureCredential` seja geralmente a maneira mais rápida de começar a desenvolver aplicativos para o Azure, os usuários mais avançados podem personalizar as credenciais consideradas durante a autenticação. `ChainedTokenCredential` permite que os usuários combinem várias instâncias de credencial para definir uma cadeia personalizada de credenciais. Este exemplo demonstra a criação de uma `ChainedTokenCredential` que tentará fazer a autenticação usando duas instâncias de `ClientSecretCredential` configuradas de modo diferente para autenticar o `KeyClient` usando [@azure/keyvault-keys](https://www.npmjs.com/package/@azure/keyvault-keys):

```javascript
const { ClientSecretCredential, ChainedTokenCredential } = require("@azure/identity");

// When an access token is requested, the chain will try each
// credential in order, stopping when one provides a token
const firstCredential = new ClientSecretCredential(tenantId, clientId, clientSecret);
const secondCredential = new ClientSecretCredential(tenantId, anotherClientId, anotherSecret);
const credentialChain = new ChainedTokenCredential(firstCredential, secondCredential);

// The chain can be used anywhere a credential is required
const { KeyClient } = require("@azure/keyvault-keys");
const client = new KeyClient(vaultUrl, credentialChain);
```

## <a name="managed-identity-support"></a>Suporte a identidade gerenciada

Há suporte para a [autenticação de identidade gerenciada](https://docs.microsoft.com/azure/active-directory/managed-identities-azure-resources/overview) por meio das classes de credencial `DefaultAzureCredential` ou `ManagedIdentityCredential` diretamente para os seguintes hosts do Azure:

- [Máquinas Virtuais do Azure](https://docs.microsoft.com/azure/active-directory/managed-identities-azure-resources/how-to-use-vm-token)
- [Serviço de Aplicativo do Azure](https://docs.microsoft.com/azure/app-service/overview-managed-identity)
- [Serviço de Kubernetes do Azure](https://docs.microsoft.com/azure/aks/use-managed-identity)
- [Azure Cloud Shell](https://docs.microsoft.com/azure/cloud-shell/msi-authorization)
- [Azure Arc](https://docs.microsoft.com/azure/azure-arc/servers/managed-identity-authentication)
- [Azure Service Fabric](https://docs.microsoft.com/azure/service-fabric/concepts-managed-identity)

Para obter exemplos de como usar a identidade gerenciada para autenticação, confira [os exemplos](https://github.com/Azure/azure-sdk-for-js/blob/hotfix/identity_1.3.0/sdk/identity/identity/samples/AzureIdentityExamples.md#authenticating-in-azure-with-managed-identity)

## <a name="credential-classes"></a>Classes de credencial

### <a name="authenticating-azure-hosted-applications"></a>Autenticação de aplicativos hospedados do Azure

| credencial                  | uso                                                                                                            | exemplo                                                                                                                                                                                                |
| --------------------------- | ---------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| `DefaultAzureCredential`    | Ofereça uma experiência de autenticação simplificada para começar rapidamente a desenvolver aplicativos executados na nuvem do Azure. | [Exemplo](https://github.com/Azure/azure-sdk-for-js/blob/hotfix/identity_1.3.0/sdk/identity/identity/samples/AzureIdentityExamples.md#authenticating-with-defaultazurecredential)                      |
| `ChainedTokenCredential`    | Permita que os usuários definam fluxos de autenticação personalizados compondo várias credenciais.                               | [Exemplo](https://github.com/Azure/azure-sdk-for-js/blob/hotfix/identity_1.3.0/sdk/identity/identity/samples/AzureIdentityExamples.md#chaining-credentials)                                            |
| `EnvironmentCredential`     | Autentica uma entidade de serviço ou um usuário por meio de informações de credencial especificadas em variáveis de ambiente.         | [Exemplo](https://github.com/Azure/azure-sdk-for-js/blob/hotfix/identity_1.3.0/sdk/identity/identity/samples/AzureIdentityExamples.md#authenticating-a-service-principal-with-environment-credentials) |
| `ManagedIdentityCredential` | Autentica a identidade gerenciada de um recurso do Azure.                                                         | [Exemplo](https://github.com/Azure/azure-sdk-for-js/blob/hotfix/identity_1.3.0/sdk/identity/identity/samples/AzureIdentityExamples.md#authenticating-in-azure-with-managed-identity)                   |

### <a name="authenticating-service-principals"></a>Autenticação de entidades de serviço

| credencial                    | uso                                                  | exemplo                                                                                                                                                                                             | reference                                                                                                                        |
| ----------------------------- | ------------------------------------------------------ | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------- |
| `ClientSecretCredential`      | Autentica uma entidade de serviço usando um segredo.      | [Exemplo](https://github.com/Azure/azure-sdk-for-js/blob/hotfix/identity_1.3.0/sdk/identity/identity/samples/AzureIdentityExamples.md#authenticating-a-service-principal-with-a-client-secret)      | [Autenticação de entidade de serviço](https://docs.microsoft.com/azure/active-directory/develop/app-objects-and-service-principals) |
| `ClientCertificateCredential` | Autentica uma entidade de serviço usando um certificado. | [Exemplo](https://github.com/Azure/azure-sdk-for-js/blob/hotfix/identity_1.3.0/sdk/identity/identity/samples/AzureIdentityExamples.md#authenticating-a-service-principal-with-a-client-certificate) | [Autenticação de entidade de serviço](https://docs.microsoft.com/azure/active-directory/develop/app-objects-and-service-principals) |

### <a name="authenticating-users"></a>Autenticação de usuários

| credencial                     | uso                                                                                                                                                                                                                       | exemplo                                                                                                                                                                                           | reference                                                                                                        |
| ------------------------------ | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------- |
| `InteractiveBrowserCredential` | Autentica interativamente um usuário com o navegador padrão do sistema. Leia mais [aqui](https://github.com/Azure/azure-sdk-for-js/blob/master/sdk/identity/identity/interactive-browser-credential.md) para saber como isso ocorre. | [Exemplo](https://github.com/Azure/azure-sdk-for-js/blob/hotfix/identity_1.3.0/sdk/identity/identity/samples/AzureIdentityExamples.md#authenticating-a-user-account-interactively-in-the-browser) | [Código de autenticação do OAuth2](https://docs.microsoft.com/azure/active-directory/develop/v2-oauth2-auth-code-flow) |
| `DeviceCodeCredential`         | Autentica de modo interativo um usuário em dispositivos com interface do usuário limitada.                                                                                                                                                              | [Exemplo](https://github.com/Azure/azure-sdk-for-js/blob/hotfix/identity_1.3.0/sdk/identity/identity/samples/AzureIdentityExamples.md#authenticating-a-user-account-with-device-code-flow)        | [Autenticação de código de dispositivo](https://docs.microsoft.com/azure/active-directory/develop/v2-oauth2-device-code)    |
| `UserPasswordCredential`       | Autentica um usuário com um nome de usuário e uma senha.                                                                                                                                                                          | [Exemplo](https://github.com/Azure/azure-sdk-for-js/blob/hotfix/identity_1.3.0/sdk/identity/identity/samples/AzureIdentityExamples.md#authenticating-a-user-account-with-username-and-password)   | [Autenticação de nome de usuário e senha](https://docs.microsoft.com/azure/active-directory/develop/v2-oauth-ropc)    |
| `AuthorizationCodeCredential`  | Autenticar um usuário com um código de autorização obtido anteriormente.                                                                                                                                                          | [Exemplo](https://github.com/Azure/azure-sdk-for-js/blob/hotfix/identity_1.3.0/sdk/identity/identity/samples/AzureIdentityExamples.md#authenticating-a-user-account-with-auth-code-flow)          | [Código de autenticação do OAuth2](https://docs.microsoft.com/azure/active-directory/develop/v2-oauth2-auth-code-flow) |

### <a name="authenticating-via-development-tools"></a>Autenticação por meio de ferramentas de desenvolvimento

| credencial                   | uso                                                              | exemplo                                                                                                                                                                                      | reference                                                                               |
| ---------------------------- | ------------------------------------------------------------------ | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------- |
| `AzureCliCredential`         | Fazer a autenticação em um ambiente de desenvolvimento com a CLI do Azure.      | [Exemplo](https://github.com/Azure/azure-sdk-for-js/blob/hotfix/identity_1.3.0/sdk/identity/identity/samples/AzureIdentityExamples.md#authenticating-a-user-account-with-azure-cli)          | [Autenticação com a CLI do Azure](https://docs.microsoft.com/cli/azure/authenticate-azure-cli) |
| `VisualStudioCodeCredential` | Fazer a autenticação em um ambiente de desenvolvimento com o Visual Studio Code. | [Exemplo](https://github.com/Azure/azure-sdk-for-js/blob/hotfix/identity_1.3.0/sdk/identity/identity/samples/AzureIdentityExamples.md#authenticating-a-user-account-with-visual-studio-code) | [Extensão do VS Code para Azure](https://code.visualstudio.com/docs/azure/extensions)          |

## <a name="troubleshooting"></a>Solução de problemas

### <a name="error-handling"></a>Tratamento de erros

As credenciais geram `AuthenticationError` quando não conseguem se autenticar. Essa classe tem um campo `message` que descreve por que a autenticação falhou. Um `AggregateAuthenticationError` será gerado por `ChainedTokenCredential` com um campo `errors` contendo uma matriz de erros de cada credencial na cadeia.

### <a name="logging"></a>Registro em log

A habilitação do log pode ajudar a descobrir informações úteis sobre falhas. Para ver um log de solicitações e respostas HTTP, defina a variável de ambiente `AZURE_LOG_LEVEL` como `info`. Como alternativa, o log pode ser habilitado no runtime chamando `setLogLevel` em `@azure/logger`:

```javascript
import { setLogLevel } from "@azure/logger";

setLogLevel("info");
```

## <a name="next-steps"></a>Próximas etapas

### <a name="read-the-documentation"></a>Leia a documentação

A documentação da API dessa biblioteca pode ser encontrada no [site da documentação](https://docs.microsoft.com/javascript/api/@azure/identity).

### <a name="provide-feedback"></a>Forneça comentários

Se você encontrar bugs ou tiver sugestões, [abra um problema](https://github.com/Azure/azure-sdk-for-js/issues).

## <a name="contributing"></a>Contribuição

Se você quiser contribuir com essa biblioteca, leia o [guia de contribuição](https://github.com/Azure/azure-sdk-for-js/blob/master/CONTRIBUTING.md) para saber como criar e testar o código.

[1]: https://azuresdkdocs.blob.core.windows.net/$web/javascript/azure-identity/1.0.0/classes/defaultazurecredential.html
[2]: https://azuresdkdocs.blob.core.windows.net/$web/javascript/azure-identity/1.0.0/classes/managedidentitycredential.html
[3]: https://azuresdkdocs.blob.core.windows.net/$web/javascript/azure-identity/1.0.0/classes/environmentcredential.html
[4]: https://azuresdkdocs.blob.core.windows.net/$web/javascript/azure-identity/1.0.0/classes/clientsecretcredential.html
[5]: https://azuresdkdocs.blob.core.windows.net/$web/javascript/azure-identity/1.0.0/classes/clientcertificatecredential.html
[6]: https://azuresdkdocs.blob.core.windows.net/$web/javascript/azure-identity/1.0.0/classes/devicecodecredential.html
[7]: https://azuresdkdocs.blob.core.windows.net/$web/javascript/azure-identity/1.0.0/classes/authorizationcodecredential.html
[8]: https://azuresdkdocs.blob.core.windows.net/$web/javascript/azure-identity/1.0.0/classes/interactivebrowsercredential.html
[9]: https://azuresdkdocs.blob.core.windows.net/$web/javascript/azure-identity/1.0.0/classes/usernamepasswordcredential.html
[azure_cli]: https://docs.microsoft.com/cli/azure
[vscodelogincommand_image]: https://raw.githubusercontent.com/Azure/azure-sdk-for-js/master/sdk/identity/identity/images/VsCodeLoginCommand.png
[azureclilogin_image]: https://raw.githubusercontent.com/Azure/azure-sdk-for-js/master/sdk/identity/identity/images/AzureCliLogin.png
[azureclilogindevicecode_image]: https://raw.githubusercontent.com/Azure/azure-sdk-for-js/master/sdk/identity/identity/images/AzureCliLoginDeviceCode.png
[defaultauthflow_image]: https://raw.githubusercontent.com/Azure/azure-sdk-for-js/master/sdk/identity/identity/images/DefaultAzureCredentialAuthenticationFlow.png

![Impressões](https://azure-sdk-impressions.azurewebsites.net/api/impressions/azure-sdk-for-js%2Fsdk%2Fidentity%2Fidentity%2FREADME.png)
